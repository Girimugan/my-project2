(("undefined"!==typeof self?self:this)["webpackJsonpthemeBundle"]=("undefined"!==typeof self?self:this)["webpackJsonpthemeBundle"]||[]).push([[3],{a418:function(e,t,s){"use strict";var i=function(){var e,t=this,s=t._self._c;return t.showModal?s("div",[s("modal",{attrs:{"is-open":t.showModal,ishideclickoutside:t.removeRxModal,rightModal:!0,title:t.orderPreferenceVisible?"Select preferred way to order":"Upload prescription"},on:{closedialog:t.closePrescriptionRightUploadModal}},[t.orderPreferenceVisible?t._e():s("div",{staticClass:"jm-bg-light-primary-grey-40 jm-d-flex fd-col jm-ai-flex-start jm-jc-flex-start position-relative jm-pb-xxl jm-ph-m jm-pt-m valid-prescription",staticStyle:{"align-self":"stretch"}},[s("div",{staticClass:"jm-body-xxs-bold jm-body-xxs jm-fc-primary-gray-100 jm-mb-xs"},[t._v("What is a valid prescription? ")]),s("div",{staticClass:"jm-mb-xs"},[s("img",{attrs:{src:t.imgbaseURL+"images/prescription-rules.svg"}})]),s("div",{staticClass:"slot-text"},[s("ul",{staticClass:"circle-list"},[s("li",[s("span",{staticClass:"jm-fc-primary-gray-80 jm-body-xxs"},[t._v(" Include details of doctor, patient & date of visit")])]),s("li",[s("span",{staticClass:"jm-fc-primary-gray-80 jm-body-xxs"},[t._v("Supported files: ")]),s("span",{staticClass:"jm-body-xxs jm-fc-primary-gray-100"},[t._v("PNG, JPEG, PDF")])]),s("li",[s("span",{staticClass:"jm-fc-primary-gray-80 jm-body-xxs"},[t._v("File size limit: ")]),s("span",{staticClass:"jm-body-xxs jm-fc-primary-gray-100"},[t._v("5MB")])])])])]),t.validatedrx.length>0&&!t.showUploadButton?s("p",{staticClass:"rx-count"},[t._v(" "+t._s(t.validatedrx.length)+" prescription"+t._s(t.validatedrx.length>1?"s":"")+" uploaded ")]):t._e(),(t.validatedrx.length>0||t.isRxUploading)&&!t.showUploadButton?s("div",{staticClass:"uploaded-prescription-container"},[t.isRxUploading?s("div",{staticClass:"jm-d-flex fd-col jm-ai-center position-relative"},[s("img",{attrs:{src:t.imgbaseURL+"images/empty-image.svg"}}),s("img",{staticClass:"rx-loader",attrs:{src:t.imgbaseURL+"images/loader.gif"}}),s("span",{staticClass:"jm-body-xxs jm-fc-light-feedback-success-50"},[t._v("Uploading...")])]):t._e(),t._l(t.validatedrx,(function(e,i){return s("div",{key:i,staticClass:"uploaded-file"},[e.type.startsWith("image/")?s("img",{staticClass:"uploaded-image",attrs:{id:i,src:e.url,alt:"Uploaded file"},on:{click:function(e){return e.stopPropagation(),t.expandImage(i)}}}):t._e(),"application/pdf"==e.type?s("img",{staticClass:"uploaded-image",attrs:{id:i,src:t.imgbaseURL+"images/ic_pdf.svg",alt:"Uploaded PDF"},on:{click:function(s){return s.stopPropagation(),t.getPdfViewerUrl(e.url)}}}):t._e(),s("img",{staticClass:"cross-icon",attrs:{src:t.imgbaseURL+"images/image-cross.svg"},on:{click:function(e){return e.stopPropagation(),(()=>t.openOrCloseDeleteRxModal(i)).apply(null,arguments)}}}),"fail"!=e.status?s("img",{staticClass:"expand-icon",attrs:{src:t.imgbaseURL+"images/expand-icon.svg"},on:{click:function(s){s.stopPropagation(),"application/pdf"==e.type?t.getPdfViewerUrl(e.url):t.expandImage(i)}}}):t._e(),"fail"==e.status?s("span",{staticClass:"jm-body-xxs jm-fc-light-feedback-error-50 text-truncate"},[t._v("Invalid image")]):t._e()])}))],2):t._e(),t.showUploadButton&&!t.orderPreferenceVisible?s("div",{staticClass:"upload-button-container"},[s("custom-button",{staticStyle:{width:"100%"},attrs:{icon:"upload",iconColor:"#08332C"},on:{click:t.openFileUploadWindow}},[s("span",{staticClass:"upload-pdf-text"},[t._v(" Upload image/PDF ")])])],1):t._e(),t.showUploadButton&&t.pastprescriptions.length>0&&!t.orderPreferenceVisible?s("div",{staticClass:"frame-29616271 jm-mt-base"},[s("div",{staticClass:"jm-d-flex"},[s("div",{staticClass:"icon2"},[s("svg",{staticClass:"swap-me4",attrs:{width:"28",height:"28",viewBox:"0 0 28 28",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M18.8182 9.18166C18.1004 8.96318 17.4718 8.51982 17.0251 7.91695C16.5784 7.31409 16.3373 6.58364 16.3373 5.83333C16.3373 5.08302 16.5784 4.35257 17.0251 3.7497C17.4718 3.14684 18.1004 2.70347 18.8182 2.485C18.8304 2.43197 18.8501 2.38091 18.8765 2.33333H8.1665C7.23825 2.33333 6.34801 2.70208 5.69163 3.35845C5.03525 4.01483 4.6665 4.90507 4.6665 5.83333V22.1667C4.6665 23.0949 5.03525 23.9852 5.69163 24.6415C6.34801 25.2979 7.23825 25.6667 8.1665 25.6667H19.8332C20.7614 25.6667 21.6517 25.2979 22.308 24.6415C22.9644 23.9852 23.3332 23.0949 23.3332 22.1667V11.4683C22.8841 11.6249 22.4078 11.6884 21.9333 11.6548C21.4589 11.6212 20.9963 11.4912 20.5738 11.2729C20.1512 11.0545 19.7776 10.7523 19.4758 10.3847C19.1739 10.0172 18.9502 9.59193 18.8182 9.13499V9.18166ZM9.33317 6.99999H12.8332C13.1426 6.99999 13.4393 7.12291 13.6581 7.3417C13.8769 7.5605 13.9998 7.85724 13.9998 8.16666C13.9998 8.47608 13.8769 8.77283 13.6581 8.99162C13.4393 9.21041 13.1426 9.33333 12.8332 9.33333H9.33317C9.02375 9.33333 8.72701 9.21041 8.50821 8.99162C8.28942 8.77283 8.1665 8.47608 8.1665 8.16666C8.1665 7.85724 8.28942 7.5605 8.50821 7.3417C8.72701 7.12291 9.02375 6.99999 9.33317 6.99999ZM18.6665 21H9.33317C9.02375 21 8.72701 20.8771 8.50821 20.6583C8.28942 20.4395 8.1665 20.1427 8.1665 19.8333C8.1665 19.5239 8.28942 19.2272 8.50821 19.0084C8.72701 18.7896 9.02375 18.6667 9.33317 18.6667H18.6665C18.9759 18.6667 19.2727 18.7896 19.4915 19.0084C19.7103 19.2272 19.8332 19.5239 19.8332 19.8333C19.8332 20.1427 19.7103 20.4395 19.4915 20.6583C19.2727 20.8771 18.9759 21 18.6665 21ZM18.6665 15.1667H9.33317C9.02375 15.1667 8.72701 15.0437 8.50821 14.825C8.28942 14.6062 8.1665 14.3094 8.1665 14C8.1665 13.6906 8.28942 13.3938 8.50821 13.175C8.72701 12.9562 9.02375 12.8333 9.33317 12.8333H18.6665C18.9759 12.8333 19.2727 12.9562 19.4915 13.175C19.7103 13.3938 19.8332 13.6906 19.8332 14C19.8332 14.3094 19.7103 14.6062 19.4915 14.825C19.2727 15.0437 18.9759 15.1667 18.6665 15.1667ZM24.4998 4.66666H23.3332V3.49999C23.3332 3.19058 23.2103 2.89383 22.9915 2.67504C22.7727 2.45624 22.4759 2.33333 22.1665 2.33333C21.8571 2.33333 21.5603 2.45624 21.3415 2.67504C21.1228 2.89383 20.9998 3.19058 20.9998 3.49999V4.66666H19.8332C19.5238 4.66666 19.227 4.78958 19.0082 5.00837C18.7894 5.22716 18.6665 5.52391 18.6665 5.83333C18.6665 6.14275 18.7894 6.43949 19.0082 6.65829C19.227 6.87708 19.5238 6.99999 19.8332 6.99999H20.9998V8.16666C20.9998 8.47608 21.1228 8.77283 21.3415 8.99162C21.5603 9.21041 21.8571 9.33333 22.1665 9.33333C22.4759 9.33333 22.7727 9.21041 22.9915 8.99162C23.2103 8.77283 23.3332 8.47608 23.3332 8.16666V6.99999H24.4998C24.8093 6.99999 25.106 6.87708 25.3248 6.65829C25.5436 6.43949 25.6665 6.14275 25.6665 5.83333C25.6665 5.52391 25.5436 5.22716 25.3248 5.00837C25.106 4.78958 24.8093 4.66666 24.4998 4.66666Z",fill:"#1ECCB0"}})])]),s("div",{staticClass:"jm-pl-base"},[s("div",{staticClass:"frame-29616399",on:{click:function(e){return t.openPastRx()}}},[s("div",{staticClass:"link"},[s("div",{staticClass:"label3"},[t._v("Choose from past prescriptions")])]),s("div",{staticClass:"icon3",class:{"rotate-180":t.isPastRxOpen,"rotate-0":!t.isPastRxOpen}},[s("svg",{staticClass:"swap-me5",attrs:{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M8.00012 10.0001C7.91239 10.0006 7.82541 9.98381 7.74419 9.95063C7.66296 9.91746 7.58908 9.86857 7.52679 9.80678L4.86012 7.14012C4.73459 7.01458 4.66406 6.84432 4.66406 6.66678C4.66406 6.48925 4.73459 6.31899 4.86012 6.19345C4.98566 6.06792 5.15592 5.99739 5.33346 5.99739C5.51099 5.99739 5.68125 6.06792 5.80679 6.19345L8.00012 8.39345L10.1935 6.19345C10.319 6.06792 10.4893 5.99739 10.6668 5.99739C10.8443 5.99739 11.0146 6.06792 11.1401 6.19345C11.2657 6.31899 11.3362 6.48925 11.3362 6.66678C11.3362 6.84432 11.2657 7.01458 11.1401 7.14012L8.47346 9.80678C8.41116 9.86857 8.33729 9.91746 8.25606 9.95063C8.17484 9.98381 8.08786 10.0006 8.00012 10.0001Z",fill:"#1E7B74"}})])])]),s("div",{staticClass:"link"},[s("div",{staticClass:"label4"},[t._v(t._s(t.pastRxCount)+" prescriptions. "),t.pastRxSelected>0?s("span",{staticClass:"jm-fc-light-feedback-success-50"},[t._v(t._s(t.pastRxSelected)+" selected.")]):t._e()])])])]),t.pastprescriptions.length>0&&t.isPastRxOpen?s("div",{staticClass:"jm-d-flex",staticStyle:{gap:"12px"}},t._l(t.pastprescriptions,(function(e,i){return s("div",{key:i,staticClass:"uploaded-file"},[s("img",{staticClass:"uploaded-image",attrs:{id:i,src:e.url,alt:"Uploaded file"},on:{click:function(e){return e.stopPropagation(),t.handleImageClick(i)}}}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.pastprescriptions[i].is_selected,expression:"pastprescriptions[index].is_selected"}],staticClass:"pointer cross-icon",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.pastprescriptions[i].is_selected)?t._i(t.pastprescriptions[i].is_selected,null)>-1:t.pastprescriptions[i].is_selected},on:{change:[function(e){var s=t.pastprescriptions[i].is_selected,a=e.target,o=!!a.checked;if(Array.isArray(s)){var l=null,r=t._i(s,l);a.checked?r<0&&t.$set(t.pastprescriptions[i],"is_selected",s.concat([l])):r>-1&&t.$set(t.pastprescriptions[i],"is_selected",s.slice(0,r).concat(s.slice(r+1)))}else t.$set(t.pastprescriptions[i],"is_selected",o)},function(e){return t.selectPastRx(i)}]}}),t.pastprescriptions[i].is_selected?t._e():s("img",{staticClass:"checkbox-disabled",attrs:{src:t.imgbaseURL+"images/ic_confirm_grey.svg"},on:{click:function(e){return e.stopPropagation(),t.handleImageClick(i)}}}),s("img",{staticClass:"expand-icon",attrs:{src:t.imgbaseURL+"images/expand-icon.svg"},on:{click:function(e){return e.stopPropagation(),t.expandPastImage(i)}}})])})),0):t._e(),t.pastRxSelected>0?s("custom-button",{staticStyle:{width:"100%"},on:{click:t.handleAddPrescription}},[s("span",{staticClass:"upload-pdf-text"},[t._v(" Add ")])]):t._e()],1):t._e(),t.validatedrx.length>0&&!t.orderPreferenceVisible&&!t.showUploadButton?s("div",{staticClass:"action-button",on:{click:t.handleShowUploadButton}},[s("div",{staticClass:"upload-more-button"},[t._v("Upload more prescription")]),s("svg",{staticClass:"ic-add",attrs:{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[s("path",{attrs:{d:"M13.3333 7.33333H8.66667V2.66667C8.66667 2.48986 8.59643 2.32029 8.4714 2.19526C8.34638 2.07024 8.17681 2 8 2C7.82319 2 7.65362 2.07024 7.5286 2.19526C7.40357 2.32029 7.33333 2.48986 7.33333 2.66667V7.33333H2.66667C2.48986 7.33333 2.32029 7.40357 2.19526 7.5286C2.07024 7.65362 2 7.82319 2 8C2 8.17681 2.07024 8.34638 2.19526 8.4714C2.32029 8.59643 2.48986 8.66667 2.66667 8.66667H7.33333V13.3333C7.33333 13.5101 7.40357 13.6797 7.5286 13.8047C7.65362 13.9298 7.82319 14 8 14C8.17681 14 8.34638 13.9298 8.4714 13.8047C8.59643 13.6797 8.66667 13.5101 8.66667 13.3333V8.66667H13.3333C13.5101 8.66667 13.6797 8.59643 13.8047 8.4714C13.9298 8.34638 14 8.17681 14 8C14 7.82319 13.9298 7.65362 13.8047 7.5286C13.6797 7.40357 13.5101 7.33333 13.3333 7.33333Z",fill:"#1E7B74"}})])]):t._e(),t.orderPreferenceVisible?s("m2OrderPreference",{attrs:{"is-desktop":!t.isMobile},on:{"close-right-search":t.closePrescriptionRightUploadModal}}):t._e(),!t.orderPreferenceVisible&&t.validatedrx.length>0&&!t.showUploadButton?s("custom-button",{staticStyle:{width:"100%"},attrs:{disabled:!1,content:"Continue",size:"large",rounded:!1,state:""},on:{click:function(e){return e.stopPropagation(),t.showOrderPreference.apply(null,arguments)}}},[s("div",{staticStyle:{color:"var(--light-mint-inverse, #08332c)"}},[t._v(" Continue ")])]):t._e(),s("prescription-image-carousel",{attrs:{images:null===(e=t.prescriptions)||void 0===e?void 0:e.filter(e=>"application/pdf"!=e.type),isopen:t.expandImageClicked,position:t.position},on:{closemodal:t.closeImageCarousel}}),s("prescription-image-carousel",{attrs:{images:t.pastprescriptions,isopen:t.pastRxExpanded,position:t.pastRxPosition},on:{closemodal:t.closePastRxImageCarousel}})],1),s("remove-rx-modal",{attrs:{openuploadmodal:t.removeRxModal},on:{closedialog:()=>t.openOrCloseDeleteRxModal(-1),deleterx:()=>t.deleteImage(t.deleteposition)}}),s("toast",{style:t.showToastMessage?{}:{display:"none"},attrs:{id:"toast-message",content:"Prescription removed"}})],1):t._e()},a=[],o=(s("13d5"),s("acef"),s("fa9e"),s("77d9"),s("3c5d"),s("8ad5")),l=s("2463"),r=s("d7e0"),d=s("bf9d"),n=s("73b3"),p=s("4ccd"),c=s("ca7f"),u=s("2bb5"),h=s("1be1"),m=s("e63a"),g=s("bc3a"),v=s.n(g),x=s("e9ad"),C={name:"Upload Prescription Modal",props:{showModal:{default:!1,required:!0,type:Boolean}},mixins:[x["a"]],components:{"custom-button":o["a"],modal:l["a"],"upload-prescription":r["a"],toast:d["default"],"prescription-image-carousel":n["a"],"remove-rx-modal":p["a"],m2OrderPreference:c["a"]},data(){return{isMobile:!1,uploadedFile:null,isImage:!1,prescriptions:[],fileType:[],storedRxId:m["a"].getItem("m2_rx_success")||[],isRxUploading:!1,uploadFailed:!1,isPastRxOpen:!1,orderPreferenceVisible:!1,position:0,removeRxModal:!1,deleteposition:-1,showToastMessage:!1,pastRxSelected:0,pastRxExpanded:!1,pastRxPosition:0,showUploadButton:!0,validatedrx:[],pastprescriptions:[],imgbaseURL:u["a"].BaseUrl,expandImageClicked:!1,pastRxCount:0}},mounted(){var e;console.log(this.showModal,">>modal"),this.isMobile=Object(h["m"])(),this.getPastRxAttachedToOrder(),this.storedRxId!=[]&&(null===(e=this.storedRxId)||void 0===e?void 0:e.length)>0&&this.getAllRecentlyUploadedRx()},methods:{handleImageClick(e){this.pastprescriptions[e].is_selected=!this.pastprescriptions[e].is_selected,this.selectPastRx(e)},handleShowUploadButton(){var e,t,s,i,a,o,l,r;const d=Number(null!==(e=null===(t=FPI)||void 0===t||null===(s=t.state)||void 0===s||null===(i=s.theme)||void 0===i||null===(a=i.globalConfig)||void 0===a||null===(o=a._data)||void 0===o||null===(l=o.props)||void 0===l?void 0:l.m2_max_prescriptions)&&void 0!==e?e:"12");(null===(r=this.validatedrx)||void 0===r?void 0:r.length)<=d-1?this.showUploadButton=!0:this.showErrorToast(`Cannot upload more than ${d} prescription`)},deleteImage(e){var t;let s=m["a"].getItem("m2_rx_success");const i=null===(t=this.pastprescriptions)||void 0===t?void 0:t.find(t=>{var i;return t.rx===(null===(i=s[e])||void 0===i?void 0:i.rxId)});if(i){var a;const e=null===(a=this.pastprescriptions)||void 0===a?void 0:a.findIndex(e=>e.rx===i.rx);this.pastprescriptions[e].is_selected=!1,this.pastRxSelected>0&&this.pastRxSelected--}console.log(s,">>delete"),s.splice(e,1),m["a"].removeItem("m2_rx_success"),s&&s.length&&(null===s||void 0===s||s.forEach(e=>{m["a"].addOrUpdateItem("m2_rx_success",e)})),"fail"==this.validatedrx.status&&(this.uploadFailed=!1),this.pastprescriptions.forEach(t=>{var s;t.url===(null===(s=this.validatedrx[e])||void 0===s?void 0:s.url)&&(t.is_selected=!1,this.pastRxSelected>0&&this.pastRxSelected--)}),this.validatedrx.splice(e,1),this.prescriptions.splice(e,1),0!=this.prescriptions.length&&0!=this.validatedrx.length||(this.orderPreferenceVisible=!1),0===this.validatedrx.length&&(this.showUploadButton=!0),this.openOrCloseDeleteRxModal(-1),this.showRemoveToast("")},handleFileUpload(e){const t=e.target.files,s=t[0],i=s.size,a=5242880,o=["application/pdf","image/png","image/jpeg"];if(i>a)this.showErrorToast("File size greater than 5MB!");else if(o.includes(null===s||void 0===s?void 0:s.type)){if(s.type.startsWith("image/"))this.prescriptions.push({url:URL.createObjectURL(s),type:s.type}),this.fileType.push(s.type),this.isImage=!0,this.uploadedFile=URL.createObjectURL(s),this.sendPrescription(this.uploadedFile).then(()=>{this.triggerAttachPrescription({journey:"M2",page_type:"Upload Prescription"})});else if("application/pdf"===s.type){this.fileType.push(s.type),this.isPDF=!0;let e="";const t=new FileReader;t.onload=()=>{e=t.result,this.prescriptions.push({url:e,type:s.type}),this.sendPrescription(e).then(()=>{this.triggerAttachPrescription({journey:"M2",page_type:"Upload Prescription"})})},t.readAsDataURL(s)}else this.isImage=!1,this.uploadedFile=URL.createObjectURL(s);this.showUploadButton=!1}else this.showErrorToast("Select Supported files")},openFileUploadWindow(){const e=document.createElement("input");console.log("m2 upload ",e),e&&(e.setAttribute("style","visibility: hidden;"),e.type="file",e.accept=".jpeg,.png,.pdf",e.addEventListener("change",this.handleFileUpload),e.click())},closeImageCarousel(){this.expandImageClicked=!1},openPastRx(){this.isPastRxOpen=!this.isPastRxOpen},selectPastRx(e){this.pastprescriptions[e].is_selected?this.pastRxSelected++:this.pastRxSelected>0&&this.pastRxSelected--},async handleAddPrescription(){var e;const t=null===this||void 0===this||null===(e=this.validatedrx)||void 0===e?void 0:e.map(e=>e.url);this.pastprescriptions.filter(e=>e.is_selected&&!(null===t||void 0===t?void 0:t.includes(null===e||void 0===e?void 0:e.url))).forEach(e=>{this.validatedrx.push({url:e.url,type:"image/jpeg",status:"success"}),this.prescriptions.push({url:e.url,type:"image/jpeg",status:"success"}),m["a"].addOrUpdateItem("m2_rx_success",{rxId:e.rx,type:"image/jpeg"})}),this.showUploadButton=!1},getAllRecentlyUploadedRx(){this.storedRxId.forEach(e=>{this.getUploadedRx(e,!1)})},async getUploadedRx(e,t){try{const s={Authorization:"Basic RosZfmdTBSLkJNSAcpLd="},i=window.location.origin;t||(e=e.rxId);const a=i+"/ext/prescription/api/v3/view/"+e;v.a.get(a,{headers:s,responseType:"arraybuffer"}).then(s=>{const i=btoa(new Uint8Array(s.data).reduce((e,t)=>e+String.fromCharCode(t),"")),a="data:image/jpeg;base64,"+i;t?this.pastprescriptions.push({url:a,rx:e,is_selected:!1}):this.validatedrx.push({url:a,status:"success",type:"image/jpeg"})}).catch(e=>{console.error("Error:",e)})}catch(s){}},async getPastRxAttachedToOrder(){try{var e,t,s,i;const u={Authorization:"Basic RosZfmdTBSLkJNSAcpLd="},h={customerId:(null===(e=JSON.parse(localStorage.getItem("m_mstarId")))||void 0===e?void 0:e.value)||(null===(t=FPI)||void 0===t||null===(s=t.state)||void 0===s||null===(i=s.user)||void 0===i?void 0:i._data.user.user_id),pageIndex:1,pageSize:3},g=window.location.origin,x=await v.a.post(g+"/ext/prescription/api/v3/allPrescription",h,{headers:u});if("SUC001"==x.data.messageCode){var a,o,l,r,d,n,p,c;this.pastRxCount=null===x||void 0===x||null===(a=x.data)||void 0===a||null===(o=a.result)||void 0===o||null===(l=o.rxAllRecentUploadList)||void 0===l?void 0:l.length;let e=null===x||void 0===x||null===(r=x.data)||void 0===r||null===(d=r.result)||void 0===d||null===(n=d.rxAllRecentUploadList)||void 0===n?void 0:n.map(e=>e.rxId);for(const i of e)await this.getUploadedRx(i,!0);let t=null===(p=m["a"].getItem("m2_rx_success"))||void 0===p?void 0:p.map(e=>e.rxId);const s=null===(c=this.pastprescriptions)||void 0===c?void 0:c.filter(e=>t.includes(e.rx));s.length>0&&s.forEach(e=>{var t;const s=null===(t=this.pastprescriptions)||void 0===t?void 0:t.findIndex(t=>t.rx===e.rx);this.pastprescriptions[s].is_selected=!0,this.pastRxSelected++})}}catch(u){console.error("Error:",u)}},uploadToRxAPI(){this.prescriptions.forEach(e=>{this.sendPrescription(e.url)})},async sendPrescription(e){try{var t,s,i,a,o;this.isRxUploading=!0;const h={Authorization:"Basic RosZfmdTBSLkJNSAcpLd="},g=await fetch(e);if(!g.ok)return void console.error("Failed to fetch blob:",g.status,g.statusText);const x=await g.blob();let C="prescription",f="";"application/pdf"===x.type?f="application/pdf":x.type.startsWith("image/")&&(f=x.type,C+="."+x.type.split("/").pop());const y=new FormData;y.append("file",new File([x],C,{type:f})),y.append("customer_id",(null===(t=JSON.parse(localStorage.getItem("m_mstarId")))||void 0===t?void 0:t.value)||(null===(s=FPI)||void 0===s||null===(i=s.state)||void 0===i||null===(a=i.user)||void 0===a?void 0:a._data.user.user_id)),y.append("channel","browser-desktop");const _=window.location.origin,R=await v.a.post(_+"/ext/prescription/api/v3/upload",y,{headers:h});var l,r;if("undefined"!==typeof(null===(o=R.data)||void 0===o?void 0:o.error))this.uploadFailed=!0,this.validatedrx.push({url:e,status:"fail",type:f});else if("application/pdf"===f){if((null===R||void 0===R||null===(l=R.data)||void 0===l?void 0:l.length)>0)for(let e=0;e<(null===R||void 0===R||null===(d=R.data)||void 0===d?void 0:d.length);e++){var d,n,p,c,u;await this.getUploadedRx({rxId:null===(n=R.data)||void 0===n||null===(p=n[e])||void 0===p?void 0:p.result});m["a"].addOrUpdateItem("m2_rx_success",{rxId:null===(c=R.data)||void 0===c||null===(u=c[e])||void 0===u?void 0:u.result,type:"image/jpeg"})}}else if(this.uploadFailed=!1,this.validatedrx.push({url:e,status:"success",type:f}),f.startsWith("image/"))m["a"].addOrUpdateItem("m2_rx_success",{rxId:null===(r=R.data)||void 0===r?void 0:r.result,type:f});this.isRxUploading=!1}catch(h){console.error("Error:",h),historyBack(this.$router),this.showErrorToast("Error in uploading prescription! Please try again.")}},showOrderPreference(){this.orderPreferenceVisible=!0},expandImage(e){var t;const s=null===(t=this.validatedrx.filter(e=>"application/pdf"!==e.type))||void 0===t?void 0:t.findIndex(t=>{var s;return(null===(s=this.validatedrx[e])||void 0===s?void 0:s.url)===t.url});this.expandImageClicked=!0,this.position=s},getPdfViewerUrl(e){const t=atob(e.split(",")[1]),s=new Array(t.length);for(let l=0;l<t.length;l++)s[l]=t.charCodeAt(l);const i=new Uint8Array(s),a=new Blob([i],{type:"application/pdf"}),o=URL.createObjectURL(a);window.open(o,"_blank")},closePastRxImageCarousel(){this.pastRxExpanded=!1},expandPastImage(e){this.pastRxExpanded=!0,this.pastRxPosition=e},showRemoveToast(e){this.showToastMessage=!0,e&&(this.toastMessage=e),this.$nextTick(()=>{const e=document.getElementById("toast-message");e.className="toast show",setTimeout((function(){e.className=e.className.replace("toast show","toast hide"),this.showToastMessage=!1}),3e3)})},openOrCloseDeleteRxModal(e){this.removeRxModal=!this.removeRxModal,this.deleteposition=e},closePrescriptionRightUploadModal(){this.$emit("closeModal"),this.orderPreferenceVisible=!1,this.showUploadButton=!0}}},f=C,y=(s("a9f7"),s("2877")),_=Object(y["a"])(f,i,a,!1,null,"91aa1f70",null);t["a"]=_.exports},a9f7:function(e,t,s){"use strict";s("e1c8")},e1c8:function(e,t,s){}}]);
//# sourceMappingURL=zWvzH8L93_themeBundle.umd.min.PrescriptioncardsSectionChunk_StaticcomponentSectionChunk.js.map